<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>
    <body class="background">
        <nav th:replace="fragments.html:: nav"></nav>
        <div class="container my-5">
            <div class="row">
                <div class="col-md-3 d-flex justify-content-center">
                    <i th:if="${#strings.isEmpty(account.profileImage)}" class="fa fa-user-circle text-white "
                       aria-hidden="true" style="font-size: 9em;"></i>
                    <img th:if="${!#strings.isEmpty(account.profileImage)}" class="img-fluid float-left rounded-circle img-thumbnail p-0"
                         th:src="${account.profileImage}" width="125" height="125"/>
                </div>
                <div class="col-md-9">
                    <div class="row mb-2">
                        <h2 th:text="${account.nickname}" style="font-weight: 300">nickname</h2>
                        <div th:if="${loginAccount != null && isOwner}" class="ml-4">
                            <a th:href="@{/accounts/edit/basicinfo}" class="btn btn-outline-primary" role="btn">프로필 편집</a>
                        </div>
                        <div id="follow-button-box" th:if="${loginAccount != null && !isOwner}" class="ml-4">
                            <button th:if="${!isFollowing}" id="btn-follow" type="button" class="btn btn-primary">팔로우</button>
                            <button th:if="${isFollowing}" id="btn-unfollow" type="button" class="btn btn-danger">언 팔로우</button>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-2 p-0">
                            게시물 <span class="font-weight-bold">0</span>
                        </div>
                        <div class="col-md-2 p-0">
                            팔로워 <span class="font-weight-bold">0</span>
                        </div>
                        <div class="col-md-2 p-0">
                            팔로우 <span class="font-weight-bold">0</span>
                        </div>
                    </div>
                    <div class="row">
                        <p>
                            <strong th:text="${account.name}">이름</strong>
                            <br>
                            <span th:utext="${account.bio}">
                                자기소개
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div th:replace="fragments.html::footer"></div>
        <div th:replace="fragments.html::ajax-csrf-header"></div>
        <script>
            $(function () {
                profile.init();
            });

            var profile = {
                init: function () {
                    var _this = this;

                    $('#follow-button-box').on('click', "#btn-follow", function () {
                        _this.follow();
                    });

                    $('#follow-button-box').on('click', "#btn-unfollow", function () {
                        _this.unfollow();
                    });
                },
                follow: function () {
                    $.ajax({
                        url: "/api/v1/accounts/[[${account.getId()}]]/follow",
                        method: 'post',
                    }).done(function (data) {
                        if (data) {
                            $('#btn-follow').addClass('btn-danger');
                            $('#btn-follow').removeClass('btn-primary');
                            $('#btn-follow').text("언 팔로우");
                            $('#btn-follow').attr('id', 'btn-unfollow');
                        }
                    }).fail(function () {
                        alert("팔로우를 실패하였습니다.");
                    });
                },
                unfollow: function () {
                    $.ajax({
                        url: "/api/v1/accounts/[[${account.getId()}]]/unfollow",
                        method: 'post',
                    }).done(function (data) {
                        if (data) {
                            $('#btn-unfollow').addClass('btn-primary');
                            $('#btn-unfollow').removeClass('btn-danger');
                            $('#btn-unfollow').text("팔로우");
                            $('#btn-unfollow').attr('id', 'btn-follow');
                        }
                    }).fail(function () {
                        alert("언팔로우를 실패하였습니다.");
                    });
                }

            }
        </script>
    </body>
</html>

