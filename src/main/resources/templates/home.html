<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>

<body class="background">
    <nav th:replace="fragments.html:: nav"></nav>
    <div th:if="${account != null && account.role.name() != 'USER'}" class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="fa fa-exclamation-triangle fa-lg" aria-hidden="true"></i>&nbsp;
        가입을 완료하려면 <a class="alert-link" th:href="@{/send-mail-info}">이메일 계정을 인증</a>해주세요.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="container" style="padding-top:30px">
        <div id="album-list" class="row"></div>
        <div id="pagination" class="row justify-content-center"></div>
    </div>

    <div th:replace="fragments.html::footer"></div>
    <script>
        $(function () {
            home.init();
        });
        const home = {
            init: function () {
                const _this = this;
                let requestObj = {
                    size : 8
                };

                $('#pagination').on('click', '.btn-page', function () {
                    let gotoPage = $(this).attr('data-index');
                    _this.loadAlbums(requestObj, gotoPage);
                });
                home.loadAlbums(requestObj, 0);
            },
            loadAlbums: function (requestObj, page) {
                requestObj.page = page;
                const _this = this;

                $.ajax({
                    url: '/api/v2/albums',
                    method: 'GET',
                    data: requestObj,
                }).done(function (pageObj) {
                    _this._clearAlbums();
                    _this._appendAlbums(pageObj);
                }).fail(function (){
                    alert("앨범들을 로드하는데 실패했습니다.");
                });
            },
            _clearAlbums: function () {
                $('#album-list').empty();
                $('#pagination').empty();
            },
            _appendAlbums: function (pageObj) {
                $('#album-list').append(pageObj['listHtml']);
                $('#pagination').append(pageObj['paginationHtml']);
            },
        }
    </script>
</body>
</html>

